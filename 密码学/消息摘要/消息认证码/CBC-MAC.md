我们之前在分组密码中提到，分组密码有许多运行模式。CBC-MAC就是基于密码分组连接模式(CBC)的MAC算法。其也被称为数据认证算法(Data
Authentication Algorithm). 但是由于其安全性欠佳，因此已被淘汰。

假设要传递的消息为$M$, 密钥为$K$, 分组密码加密算法为$\E{k}{m}$,
其分组长度为$b$比特。

CBC-MAC的过程如下：

1.  填充

    将消息$M$通过在末尾补'0'填充为长度是$b$的整数倍$nb$的二进制串$M'$,
    并将其分为$n$个长度为$b$比特的二进制串$m_1, m_2, \ldots, m_n$.

2.  加密

    采用以下公式进行加密： $$\begin{aligned}
        &O_1=\E{K}{m_1}\\
        &O_{i}=\E{K}{O_{i-1}\oplus m_{i}},\quad i=2, 3,\ldots, n
        
    \end{aligned}$$

3.  输出

    CBC-MAC的输出为$b$比特二进制串$O_n$

从本质上来说，这个算法就是一个初始值$\mathrm{IV}=0$的CBC模式分组加密算法，取其最后一个分组的输出。

对于固定长度的消息来说，如果使用的分组加密算法是安全的，那么CBC-MAC也是安全的。但是，对于长度不固定的消息来说，这是不安全的。

用加密最后一组密文当作 MAC, 前面任意一组密文改动都会导致最后一组密文的变化.