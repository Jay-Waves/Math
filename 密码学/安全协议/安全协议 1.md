# 安全协议


## 密钥协议

### 对称密码的密钥分配


#### 点对点密钥分配
d

#### 密钥分配中心

d

#### NS协议

基于KDC的密钥分配方式，其核心在于如何利用主密钥获得会话密钥。常用的方法为Needham-Schroeder协议，简称NS协议。其基本步骤为：

假设A和B要进行加密通信，$S$为KDC,
$K_{AS}, K_{BS}$分别是$A$和$B$拥有的主密钥，$\ID_A, \ID_B$分别为$A$和$B$的身份识别号，$N_A, N_B$分别为$A$和$B$产生的一个一次性随机数，$K_{AB}$为加密通信所需要的会话密钥。那么，其步骤为：

1.  $A$发送给$S$一个信息，用于确定他和$B$的身份，告诉$S$他想与$B$进行通信
    $$A\to S: \ID_A, \ID_B, N_A$$

2.  KDC, 即$S$, 生成一个$K_{AB}$,
    并将其用$K_{BS}$与一部分数据加密后返回给$A$
    $$S\to A: \brace{N_A, K_{AB}, \ID_B, \brace{K_{AB}, \ID_A}_{K_{BS}}}_{K_{AS}}$$

3.  $A$使用$K_{AS}$解密了上一步获得的密文，同时将得到的$\brace{K_{AB}, A}_{K_{BS}}$发送给$B$
    $$A\to B: \brace{K_{AB}, \ID_A}_{K_{BS}}$$

4.  $B$发送给$A$一个用$K_{AB}$加密的随机数
    $$B\to A: \brace{N_B}_{K_{AB}}$$

5.  $A$利用$K_{AB}$解密了上一步得到的密文，并将其减一后用$K_{AB}$加密发送给$B$
    $$A\to B: \brace{N_B - 1}_{K_{AB}}$$

我们在分析安全通信协议的时候，需要考虑的是，如何证明本轮收到的信息是对方发的，并且是针对自己上一轮发送信息的回馈。那么，我们从第二轮开始分析：

第二轮中，由于$K_{AS}$只有$A$和$S$知道，因此，如果能用$K_{AS}$正确解密信息，就说明获得的信息是$S$发的。同时，如果解密得到了$N_A$，就说明这次收到的信息是$S$针对上次发送的信息的回馈。

第五轮中，由于$K_{BS}$只有$B$和$S$知道，因此，只有$B$能获得第三轮中发送的$K_{AB}$.
因此，如果$B$使用$K_{AB}$解密得到的信息确实是第四步生成的随机数减一，那么就说明获得的信息确实是$A$发的，并且也确实是对之前发送信息的回馈。

但是，这样的安全通信协议可以被重放攻击。如果一个攻击者使用了一个旧的，已经被泄露出来的$K_{AB}$,
那么他可以重放信息$\brace{K_{AB}, A}_{K_{BS}}$给$B$,
从而让$B$误以为自己是$A$.
这样攻击的主要原因就在于该协议的第三步中，$B$无法确定发送者是否是当前的$A$.

在实际应用中，比如说，一个员工可以多次重复上述协议的前几步，收集其与每台服务器之间通信的$\brace{K_{AB}, \ID_A}_{K_{BS}}$.
那么即使他被解雇了，他依然可以利用这些信息来登录服务器。在这个漏洞被指出之前，这种协议被使用了持续了有快十年。

#### Kerberos

[Kerberos 协议](认证的密钥协商协议/Kerberos%20协议.md)

### 公钥密码体系的安全协议

...



### 基于公钥密码的会话密钥分配协议

...

[秘密共享](秘密共享.md)
